!function(t,e,i){"use strict";function o(i,o){var a,s=i.data();this.$element=i,this.options=t.extend({},n,s,o),this.$preloader=t(this.options.preloader),a=new RegExp(this.options.url.replace("{number}","(\\d+)"),"i"),this.currentPage=e.location.search.match(a)?e.location.search.match(a):1,this.lastLoadedPage=this.currentPage,this.isLoading=!1,this.pagesPositions=[],this.init()}var a="ufiScroll",n={url:e.location.pathname+e.location.search+(e.location.search?"&page={number}":"?page={number}")+e.location.hash,pageCount:null,preloader:'<div class="preloader">Loading...</div>',selectors:{itemFirst:".ufi-item-first",itemLast:".ufi-item-last"},pagination:function(e){for(var i,o=t('<div class="ufi-pagination"/>'),a=t('<a href="#" class="ufi-pagination_page"/>'),n=t('<span class="ufi-pagination_separator">...</span>'),s=this.generatePagination(e,this.options.pageCount,3,1,1),r=0;r<s.length;r++)"string"!=typeof s[r]?(i=a.clone(),i.text(s[r]),s[r].isActive&&i.addClass("_active")):i=n.clone(),o.append(i);t("body").find(".ufi-pagination").length?t("body").find(".ufi-pagination").replaceWith(o):t("body").append(o)}};o.prototype={init:function(){this._pageItemsEnhancment(this.$element,this.currentPage),this._getPagePosition(this.lastLoadedPage),this._scrollInit(),this.options.pagination.call(this,this.currentPage)},_scrollInit:function(){var i=this._delayFunctionCall(1,50,this._scrollHandler),o=this;this._loadPage(2),setTimeout(function(){o._loadPage(3)},300),setTimeout(function(){o._loadPage(4)},600),setTimeout(function(){o._loadPage(5)},900),t(e).on("scroll.ufi",function(){i()})},_scrollHandler:function(){var i=t(e).scrollTop(),o=t(e).height(),a=i+o,n=this._getPagePosition(this.lastLoadedPage),s=.25*(n.bottom-n.top);i=this._improveScrollTop(i),this.lastLoadedPage<this.options.pageCount&&a>=n.bottom-s&&this._loadPage(this.lastLoadedPage+1),this.currentPage!==this._getVisiblePage(i)&&(this.currentPage=this._getVisiblePage(i),this.options.pagination.call(this,this.currentPage))},_loadPage:function(e){var i=this;this.isLoading||(this.isLoading=!0,this._showPreloader(),t.ajax({url:this.options.url.replace("{number}",e),success:function(o){var a=t(o).find(i.$element.selector);a.length||(a=t(o)),i._pageItemsEnhancment(a,e),i.currentPage=e,i.$element.append(a.find(".item")),i.lastLoadedPage=e,setTimeout(function(){i._getPagePosition(e)},0),i._hidePreloader(),i.isLoading=!1}}))},_showPreloader:function(){this.$element.append(this.$preloader)},_hidePreloader:function(){this.$preloader.remove()},_improveScrollTop:function(t){if(this.lastLoadedPage===this.options.pageCount){var e=this._getLastPageFit();if(e===this.options.pageCount)return t;var o=this._getPagePosition(e).top,a=i.documentElement.scrollHeight,n=i.documentElement.clientHeight,s=a-(o+n);300>s&&(o-=300-s,s=300);var r=n*((t-o)/s);t>o&&(t+=r)}return t},_calculatePageHeight:function(t){var e=this._getPagePosition(t);return e.bottom-e.top},_getPagePosition:function(t){if(this.pagesPositions[t])return this.pagesPositions[t];var e=this._getLastItemOnPage(t);return this.pagesPositions[t]={top:this._getFirstItemOnPage(t).offset().top,bottom:e.offset().top+e.outerHeight()},this.pagesPositions[t]},_getLastPageFit:function(){for(var t=this.pagesPositions.length-1;t>0&&!(i.documentElement.scrollHeight-this._getPagePosition(t).top>i.documentElement.clientHeight);t--);return t},_getVisiblePage:function(t){for(var e=this.pagesPositions.length-1;e>0;e--){var i=this._getPagePosition(e);if(t>=i.top&&t<=i.bottom)return e}return this.currentPage},_getFirstItemOnPage:function(t){return this.$element.find(this.options.selectors.itemFirst+'[data-page="'+t+'"]')},_getLastItemOnPage:function(t){return this.$element.find(this.options.selectors.itemLast+'[data-page="'+t+'"]')},_pageItemsEnhancment:function(t,e){t.find("> *:first").addClass(this.options.selectors.itemFirst.slice(1)).attr("data-page",e),t.find("> *:last").addClass(this.options.selectors.itemLast.slice(1)).attr("data-page",e)},_delayFunctionCall:function(t,e,i){var o,a=0,n=(new Date).getTime(),s=this;return"function"!=typeof i?!1:(t=t||1,e=e||50,function(){var r=(new Date).getTime(),l=arguments;return r-n>e&&(a=0,n=r),clearTimeout(o),o=setTimeout(function(){i.apply(s,l),n=(new Date).getTime()},e-(r-n)),t>a?(a++,clearTimeout(o),i.apply(s,l)):void 0})},generatePagination:function(t,e,i,o,a){i=i||1,o=o||0,a=a||0;var n,s,r=[],l=[],h=o?2:0,g=a?2:0,u=i+o+a+h/2+g/2,c=Math.ceil((i-1)/2),p=i-1-c,d=!1,f=!1;for(u>=e?r.push({from:1,to:e}):(d=o+h+c>=t,f=t+p+a+g>e,d?r.push({from:1,to:Math.max(o,1)+h+c+p}):(r.push({from:1,to:o}),h&&r.push("..."),f||r.push({from:t-c,to:t})),f?r.push({from:e+1-p-c-Math.max(a,1)-g,to:e}):(d||r.push({from:t+1,to:t+p}),g&&r.push("..."),r.push({from:e-a+1,to:e}))),s=0;s<r.length;s++)if(r[s].from)for(var m=r[s].from;m<=r[s].to;m++)n=new Number(m),m===t&&(n.isActive=!0),l.push(n);else l.push(r[s]);return l}},t.fn[a]=function(e){var i=this.first();return i.selector=this.selector+":first",t.data(i,a)||t.data(i,a,new o(i,e)),this}}(jQuery,window,document);
//# sourceMappingURL=jquery.ufi.min.js.map