!function(t,e,i){"use strict";function o(i,o){var s,n=i.data();this.$element=i,this.options=t.extend(!0,{},a,n,o),this.$preloader=t(this.options.preloader),s=new RegExp(this.options.url.replace("{number}","(\\d+)"),"i"),this.currentPage=e.location.search.match(s)?e.location.search.match(s):1,this.lastLoadedPage=this.currentPage,this.isLoading=!1,this.pagesPositions=[],this.history=e.history&&e.history.pushState?e.history:!1,this.init()}var s="ufiScroll",a={url:e.location.pathname+e.location.search.replace(/&?page=\d+/gi,"")+(e.location.search?"&page={number}":"?page={number}")+e.location.hash,pageCount:null,preloader:'<div class="preloader">Loading...</div>',selectors:{itemFirst:".ufi-item-first",itemLast:".ufi-item-last",items:"> *"},pagination:function(e){for(var i,o=t('<div class="ufi-pagination"/>'),s=t('<a href="#" class="ufi-pagination_page"/>'),a=t('<span class="ufi-pagination_separator">...</span>'),n=this.generatePagination(e,this.options.pageCount,3,1,1),r=0;r<n.length;r++)"string"!=typeof n[r]?(i=s.clone(),i.text(n[r]),n[r].isActive&&i.addClass("_active")):i=a.clone(),o.append(i);t("body").find(".ufi-pagination").length?t("body").find(".ufi-pagination").replaceWith(o):t("body").append(o)}};o.prototype={init:function(){this._pageItemsEnhancment(this.$element,this.currentPage),this._getPagePosition(this.lastLoadedPage),this._scrollInit(),this.options.pagination.call(this,this.currentPage)},_scrollInit:function(){var i=this._delayFunctionCall(1,50,this._scrollHandler);this._preloadPages(),t(e).on("scroll.ufi",function(){i()})},_scrollHandler:function(){var t=this._calculateScroll(),e=this._getPagePosition(this.lastLoadedPage),i=.25*this._calculatePageHeight(this.lastLoadedPage);this.lastLoadedPage<this.options.pageCount&&t.bottom>=e.bottom-i&&this._loadPage(this.lastLoadedPage+1),this.currentPage!==this._getVisiblePage(t.top)&&(this.currentPage=this._getVisiblePage(t.top),this._pushState(this.currentPage),this.options.pagination.call(this,this.currentPage))},_pushState:function(t){this.history&&this.history.pushState(null,null,this.options.url.replace("{number}",t))},_preloadPages:function(){var i=this;this.lastLoadedPage<this.options.pageCount&&t(e).height()>=this._getPagePosition(this.lastLoadedPage).bottom&&this._loadPage(this.lastLoadedPage+1,function(){i._preloadPages()})},_loadPage:function(e,i){var o=this;i="function"==typeof i?i:function(){},this.isLoading||(this.isLoading=!0,this._showPreloader(),t.ajax({url:this.options.url.replace("{number}",e),success:function(s){var a=t(s).find(o.$element.selector);a.length||(a=t(s)),o._pageItemsEnhancment(a,e),o.currentPage=e,o.$element.append(a.find(".item")),o.lastLoadedPage=e,setTimeout(function(){o._getPagePosition(e)},0),o._hidePreloader(),o.isLoading=!1,i()}}))},_showPreloader:function(){this.$element.append(this.$preloader)},_hidePreloader:function(){this.$preloader.remove()},_calculateScroll:function(){var i=t(e).scrollTop();return{top:this._improveScrollTop(i),bottom:t(e).height()+i}},_improveScrollTop:function(t){if(this.lastLoadedPage===this.options.pageCount){var e=this._getLastPageFit();if(e===this.options.pageCount)return t;var o=this._getPagePosition(e).top,s=i.documentElement.scrollHeight,a=i.documentElement.clientHeight,n=s-(o+a);300>n&&(o-=300-n,n=300);var r=a*((t-o)/n);t>o&&(t+=r)}return t},_calculatePageHeight:function(t){var e=this._getPagePosition(t);return e.bottom-e.top},_getPagePosition:function(t){if(this.pagesPositions[t])return this.pagesPositions[t];var e=this._getLastItemOnPage(t);return this.pagesPositions[t]={top:this._getFirstItemOnPage(t).offset().top,bottom:e.offset().top+e.outerHeight()},this.pagesPositions[t]},_getLastPageFit:function(){for(var t=this.pagesPositions.length-1;t>0&&!(i.documentElement.scrollHeight-this._getPagePosition(t).top>i.documentElement.clientHeight);t--);return t},_getVisiblePage:function(t){for(var e=this.pagesPositions.length-1;e>0;e--){var i=this._getPagePosition(e);if(t>=i.top&&t<=i.bottom||e===this.options.pageCount&&t>=i.top)return e}return this.currentPage},_getFirstItemOnPage:function(t){return this.$element.find(this.options.selectors.itemFirst+'[data-page="'+t+'"]')},_getLastItemOnPage:function(t){return this.$element.find(this.options.selectors.itemLast+'[data-page="'+t+'"]')},_pageItemsEnhancment:function(t,e){t.find(this.options.selectors.items+":first").addClass(this.options.selectors.itemFirst.slice(1)).attr("data-page",e),t.find(this.options.selectors.items+":last").addClass(this.options.selectors.itemLast.slice(1)).attr("data-page",e)},_delayFunctionCall:function(t,e,i){var o,s=0,a=(new Date).getTime(),n=this;return"function"!=typeof i?!1:(t=t||1,e=e||50,function(){var r=(new Date).getTime(),h=arguments;return r-a>e&&(s=0,a=r),clearTimeout(o),o=setTimeout(function(){i.apply(n,h),a=(new Date).getTime()},e-(r-a)),t>s?(s++,clearTimeout(o),i.apply(n,h)):void 0})},generatePagination:function(t,e,i,o,s){i=i||1,o=o||0,s=s||0;var a,n,r=[],h=[],l=o?2:0,g=s?2:0,u=i+o+s+l/2+g/2,c=Math.ceil((i-1)/2),p=i-1-c,d=!1,f=!1;for(u>=e?r.push({from:1,to:e}):(d=o+l+c>=t,f=t+p+s+g>e,d?r.push({from:1,to:Math.max(o,1)+l+c+p}):(r.push({from:1,to:o}),l&&r.push("..."),f||r.push({from:t-c,to:t})),f?r.push({from:e+1-p-c-Math.max(s,1)-g,to:e}):(d||r.push({from:t+1,to:t+p}),g&&r.push("..."),r.push({from:e-s+1,to:e}))),n=0;n<r.length;n++)if(r[n].from)for(var m=r[n].from;m<=r[n].to;m++)a=new Number(m),m===t&&(a.isActive=!0),h.push(a);else h.push(r[n]);return h}},t.fn[s]=function(t){var e=this.first();return e.selector=this.selector+":first",e.data(s)||e.data(s,new o(e,t)),this}}(jQuery,window,document);
//# sourceMappingURL=jquery.ufi.min.js.map