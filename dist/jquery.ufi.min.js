!function(t,e,i){"use strict";function s(i,s){var o,n=i.data();this.$element=i,this.options=t.extend(!0,{},a,n,s),this.$preloader=t(this.options.preloader),o=new RegExp(this.options.url.replace("{number}","(\\d+)"),"i"),this.currentPage=e.location.search.match(o)?e.location.search.match(o):1,this.lastLoadedPage=this.currentPage,this.isLoading=!1,this.pagesPositions=[],this.history=e.history&&e.history.pushState?e.history:!1,this.init()}var o="ufiScroll",a={url:e.location.pathname+e.location.search.replace(/&?page=\d+/gi,"")+(e.location.search?"&page={number}":"?page={number}")+e.location.hash,pageCount:null,preloader:'<div class="preloader">Loading...</div>',selectors:{itemFirst:".ufi-item-first",itemLast:".ufi-item-last",items:"> *"},pagination:function(e){for(var i,s=t('<div class="ufi-pagination"/>'),o=t('<a href="#" class="ufi-pagination_page"/>'),a=t('<span class="ufi-pagination_separator">...</span>'),n=this.generatePagination(e,this.options.pageCount,3,1,1),r=0;r<n.length;r++)"string"!=typeof n[r]?(i=o.clone(),i.text(n[r]),n[r].isActive&&i.addClass("_active")):i=a.clone(),s.append(i);t("body").find(".ufi-pagination").length?t("body").find(".ufi-pagination").replaceWith(s):t("body").append(s)}};s.prototype={init:function(){this._pageItemsEnhancment(this.$element,this.currentPage),this._getPagePosition(this.lastLoadedPage),this._scrollInit(),this.options.pagination.call(this,this.currentPage)},_scrollInit:function(){var i=this._delayFunctionCall(1,50,this._scrollHandler),s=this;this._loadPage(2),setTimeout(function(){s._loadPage(3)},300),setTimeout(function(){s._loadPage(4)},600),setTimeout(function(){s._loadPage(5)},900),t(e).on("scroll.ufi",function(){i()})},_scrollHandler:function(){var i=t(e).scrollTop(),s=t(e).height(),o=i+s,a=this._getPagePosition(this.lastLoadedPage),n=.25*(a.bottom-a.top);i=this._improveScrollTop(i),this.lastLoadedPage<this.options.pageCount&&o>=a.bottom-n&&this._loadPage(this.lastLoadedPage+1),this.currentPage!==this._getVisiblePage(i)&&(this.currentPage=this._getVisiblePage(i),this._pushState(this.currentPage),this.options.pagination.call(this,this.currentPage))},_pushState:function(t){this.history&&this.history.pushState(null,null,this.options.url.replace("{number}",t))},_loadPage:function(e){var i=this;this.isLoading||(this.isLoading=!0,this._showPreloader(),t.ajax({url:this.options.url.replace("{number}",e),success:function(s){var o=t(s).find(i.$element.selector);o.length||(o=t(s)),i._pageItemsEnhancment(o,e),i.currentPage=e,i.$element.append(o.find(".item")),i.lastLoadedPage=e,setTimeout(function(){i._getPagePosition(e)},0),i._hidePreloader(),i.isLoading=!1}}))},_showPreloader:function(){this.$element.append(this.$preloader)},_hidePreloader:function(){this.$preloader.remove()},_improveScrollTop:function(t){if(this.lastLoadedPage===this.options.pageCount){var e=this._getLastPageFit();if(e===this.options.pageCount)return t;var s=this._getPagePosition(e).top,o=i.documentElement.scrollHeight,a=i.documentElement.clientHeight,n=o-(s+a);300>n&&(s-=300-n,n=300);var r=a*((t-s)/n);t>s&&(t+=r)}return t},_calculatePageHeight:function(t){var e=this._getPagePosition(t);return e.bottom-e.top},_getPagePosition:function(t){if(this.pagesPositions[t])return this.pagesPositions[t];var e=this._getLastItemOnPage(t);return this.pagesPositions[t]={top:this._getFirstItemOnPage(t).offset().top,bottom:e.offset().top+e.outerHeight()},this.pagesPositions[t]},_getLastPageFit:function(){for(var t=this.pagesPositions.length-1;t>0&&!(i.documentElement.scrollHeight-this._getPagePosition(t).top>i.documentElement.clientHeight);t--);return t},_getVisiblePage:function(t){for(var e=this.pagesPositions.length-1;e>0;e--){var i=this._getPagePosition(e);if(t>=i.top&&t<=i.bottom)return e}return this.currentPage},_getFirstItemOnPage:function(t){return this.$element.find(this.options.selectors.itemFirst+'[data-page="'+t+'"]')},_getLastItemOnPage:function(t){return this.$element.find(this.options.selectors.itemLast+'[data-page="'+t+'"]')},_pageItemsEnhancment:function(t,e){t.find(this.options.selectors.items+":first").addClass(this.options.selectors.itemFirst.slice(1)).attr("data-page",e),t.find(this.options.selectors.items+":last").addClass(this.options.selectors.itemLast.slice(1)).attr("data-page",e)},_delayFunctionCall:function(t,e,i){var s,o=0,a=(new Date).getTime(),n=this;return"function"!=typeof i?!1:(t=t||1,e=e||50,function(){var r=(new Date).getTime(),h=arguments;return r-a>e&&(o=0,a=r),clearTimeout(s),s=setTimeout(function(){i.apply(n,h),a=(new Date).getTime()},e-(r-a)),t>o?(o++,clearTimeout(s),i.apply(n,h)):void 0})},generatePagination:function(t,e,i,s,o){i=i||1,s=s||0,o=o||0;var a,n,r=[],h=[],l=s?2:0,g=o?2:0,u=i+s+o+l/2+g/2,c=Math.ceil((i-1)/2),p=i-1-c,d=!1,f=!1;for(u>=e?r.push({from:1,to:e}):(d=s+l+c>=t,f=t+p+o+g>e,d?r.push({from:1,to:Math.max(s,1)+l+c+p}):(r.push({from:1,to:s}),l&&r.push("..."),f||r.push({from:t-c,to:t})),f?r.push({from:e+1-p-c-Math.max(o,1)-g,to:e}):(d||r.push({from:t+1,to:t+p}),g&&r.push("..."),r.push({from:e-o+1,to:e}))),n=0;n<r.length;n++)if(r[n].from)for(var m=r[n].from;m<=r[n].to;m++)a=new Number(m),m===t&&(a.isActive=!0),h.push(a);else h.push(r[n]);return h}},t.fn[o]=function(t){var e=this.first();return e.selector=this.selector+":first",e.data(o)||e.data(o,new s(e,t)),this}}(jQuery,window,document);
//# sourceMappingURL=jquery.ufi.min.js.map