{"version":3,"sources":["jquery.ufi.min.js"],"names":["$","window","document","Ufi","$element","options","pageRegExp","data","this","extend","defaults","$preloader","preloader","RegExp","url","replace","currentPage","location","search","match","lastLoadedPage","isLoading","pagesPositions","history","pushState","init","pluginName","pathname","hash","pageCount","selectors","itemFirst","itemLast","items","pagination","current","$tempEl","$pagination","$page","$separator","paginationRaw","generatePagination","i","length","clone","text","isActive","addClass","append","find","replaceWith","prototype","_pageItemsEnhancment","_getPagePosition","_scrollInit","call","_scrollHandler","_delayFunctionCall","self","_loadPage","setTimeout","on","scrollTop","winHeight","height","scrollBottom","lastLoadedPagePosition","prediction","bottom","top","_improveScrollTop","_getVisiblePage","_pushState","page","_showPreloader","ajax","success","html","$content","selector","_hidePreloader","remove","lastPageFit","_getLastPageFit","lastPageFitTop","docHeight","documentElement","scrollHeight","clientHeight","remainder","modificator","_calculatePageHeight","pagePosition","$itemLast","_getLastItemOnPage","_getFirstItemOnPage","offset","outerHeight","slice","attr","times","interval","func","timeout","callCount","startTime","Date","getTime","callTime","args","arguments","clearTimeout","apply","countPages","pages","firstPages","lastPages","number","ranges","result","firstHidedPages","lastHidedPages","minimumPages","beforeCurrentPage","Math","ceil","afterCurrentPage","isFirstEnhancment","isLastEnhancment","push","from","to","max","j","Number","fn","first","jQuery"],"mappings":"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","file":"jquery.ufi.min.js","sourcesContent":["/**\n * User friendly infinity scroll\n * Author: @snake_345\n * Licensed under the MIT license\n */\n\n;(function ($, window, document) {\n\t'use strict';\n\n\tvar pluginName = 'ufiScroll';\n\tvar\tdefaults = {\n\t\turl: window.location.pathname +\n\t\t\t window.location.search.replace(/&?page=\\d+/gi, '') +\n\t\t\t (window.location.search ? '&page={number}' : '?page={number}') +\n\t\t\t window.location.hash,\n\t\tpageCount: null,\n\t\tpreloader: '<div class=\"preloader\">Loading...</div>',\n\t\tselectors: {\n\t\t\titemFirst: '.ufi-item-first',\n\t\t\titemLast: '.ufi-item-last',\n\t\t\titems: '> *'\n\t\t},\n\t\tpagination: function(current) {\n\t\t\tvar $pagination = $('<div class=\"ufi-pagination\"/>');\n\t\t\tvar $page = $('<a href=\"#\" class=\"ufi-pagination_page\"/>');\n\t\t\tvar $separator = $('<span class=\"ufi-pagination_separator\">...</span>');\n\t\t\tvar paginationRaw = this.generatePagination(current, this.options.pageCount, 3, 1, 1);\n\t\t\tvar $tempEl;\n\n\t\t\tfor (var i = 0; i < paginationRaw.length; i++) {\n\t\t\t\tif (typeof paginationRaw[i] !== 'string') {\n\t\t\t\t\t$tempEl = $page.clone();\n\t\t\t\t\t$tempEl.text(paginationRaw[i]);\n\t\t\t\t\tif (paginationRaw[i].isActive) {\n\t\t\t\t\t\t$tempEl.addClass('_active');\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$tempEl = $separator.clone();\n\t\t\t\t}\n\n\t\t\t\t$pagination.append($tempEl);\n\t\t\t}\n\n\t\t\tif ($('body').find('.ufi-pagination').length) {\n\t\t\t\t$('body').find('.ufi-pagination').replaceWith($pagination);\n\t\t\t} else {\n\t\t\t\t$('body').append($pagination);\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction Ufi($element, options) {\n\t\tvar pageRegExp;\n\t\tvar data = $element.data();\n\t\tthis.$element = $element;\n\t\tthis.options = $.extend(true, {}, defaults, data, options);\n\t\tthis.$preloader = $(this.options.preloader);\n\n\t\tpageRegExp = new RegExp(this.options.url.replace('{number}', '(\\\\d+)'), 'i');\n\t\tthis.currentPage = window.location.search.match(pageRegExp) ? window.location.search.match(pageRegExp) : 1;\n\t\tthis.lastLoadedPage = this.currentPage;\n\t\tthis.isLoading = false;\n\t\tthis.pagesPositions = [];\n\t\tthis.history = window.history && window.history.pushState ? window.history : false;\n\n\t\tthis.init();\n\t}\n\n\tUfi.prototype = {\n\t\tinit: function() {\n\t\t\tthis._pageItemsEnhancment(this.$element, this.currentPage);\n\t\t\tthis._getPagePosition(this.lastLoadedPage);\n\t\t\tthis._scrollInit();\n\t\t\tthis.options.pagination.call(this, this.currentPage);\n\t\t},\n\n\t\t_scrollInit: function() {\n\t\t\tvar _scrollHandler = this._delayFunctionCall(1, 50, this._scrollHandler);\n\n\t\t\t/***********************\n\t\t\t * Временное решение\n\t\t\t ***********************/\n\t\t\t// TODO: дописать подгрузку нужного количества страниц\n\t\t\tvar self = this;\n\t\t\tthis._loadPage(2);\n\n\t\t\tsetTimeout(function() {\n\t\t\t\tself._loadPage(3);\n\t\t\t}, 300);\n\t\t\tsetTimeout(function() {\n\t\t\t\tself._loadPage(4);\n\t\t\t}, 600);\n\t\t\tsetTimeout(function() {\n\t\t\t\tself._loadPage(5);\n\t\t\t}, 900);\n\t\t\t/***********************\n\t\t\t * Временное решение\n\t\t\t ***********************/\n\n\t\t\t$(window).on('scroll.ufi', function() {\n\t\t\t\t_scrollHandler();\n\t\t\t});\n\t\t},\n\n\t\t_scrollHandler: function() {\n\t\t\tvar scrollTop = $(window).scrollTop();\n\t\t\tvar winHeight = $(window).height();\n\t\t\tvar scrollBottom = scrollTop + winHeight;\n\t\t\tvar lastLoadedPagePosition = this._getPagePosition(this.lastLoadedPage);\n\t\t\tvar prediction = (lastLoadedPagePosition.bottom - lastLoadedPagePosition.top) * 0.25;\n\n\t\t\tscrollTop = this._improveScrollTop(scrollTop);\n\n\t\t\tif (this.lastLoadedPage < this.options.pageCount) {\n\t\t\t\tif (scrollBottom >= lastLoadedPagePosition.bottom - prediction) {\n\t\t\t\t\tthis._loadPage(this.lastLoadedPage + 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.currentPage !== this._getVisiblePage(scrollTop)) {\n\t\t\t\tthis.currentPage = this._getVisiblePage(scrollTop);\n\t\t\t\tthis._pushState(this.currentPage);\n\t\t\t\tthis.options.pagination.call(this, this.currentPage);\n\t\t\t}\n\t\t},\n\n\t\t_pushState: function(page) {\n\t\t\tif (this.history) {\n\t\t\t\tthis.history.pushState(null, null, this.options.url.replace('{number}', page));\n\t\t\t}\n\t\t},\n\n\t\t_loadPage: function(page) {\n\t\t\tvar self = this;\n\t\t\tif (!this.isLoading) {\n\t\t\t\tthis.isLoading = true;\n\t\t\t\tthis._showPreloader();\n\t\t\t\t$.ajax({\n\t\t\t\t\turl: this.options.url.replace('{number}', page),\n\t\t\t\t\tsuccess: function(html) {\n\t\t\t\t\t\tvar $content = $(html).find(self.$element.selector);\n\n\t\t\t\t\t\tif (!$content.length) {\n\t\t\t\t\t\t\t$content = $(html);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself._pageItemsEnhancment($content, page);\n\t\t\t\t\t\tself.currentPage = page;\n\t\t\t\t\t\tself.$element.append($content.find('.item'));\n\t\t\t\t\t\tself.lastLoadedPage = page;\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tself._getPagePosition(page);\n\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\tself._hidePreloader();\n\t\t\t\t\t\tself.isLoading = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\n\t\t_showPreloader: function() {\n\t\t\tthis.$element.append(this.$preloader);\n\t\t},\n\n\t\t_hidePreloader: function() {\n\t\t\tthis.$preloader.remove();\n\t\t},\n\n\t\t_improveScrollTop: function(scrollTop) {\n\t\t\t// Последние страницы, могут быть слишком маленькими по высоте и тогда их верхняя граница\n\t\t\t// никогда не пересекёт scrollTop, таким образом нет возможности определить,\n\t\t\t// что они уже видимы и соответсвующе перестроить пагинацию.\n\t\t\t// Тоесть у пагинации не будет возможности определить последнии страницы и они никогда не станут активными.\n\t\t\t// Для борьбы с этой проблемой в данной функции реализовано следующее решение:\n\t\t\t//   - Получаем номер последней страницы верхняя граница которой меньше максимального scrollTop\n\t\t\t//   - расчитываем сколько мы ещё можем прокуртить после этой страницы\n\t\t\t//   - если прокрутить можно меньше чем 300 пикселей, двигаем верхнюю границу найденной страницы так, чтобы после\n\t\t\t//     определения, что это активная страница, можно было прокрутить ещё 300 пикселей\n\t\t\t//   - увеличиваем scrollTop относительно прокрученного остатка\n\t\t\t//   - таким образом добиваемся что мнимый scrollTop пересекет верхние границы всех страниц\n\t\t\tif (this.lastLoadedPage === this.options.pageCount) { // Если последняя страница загружена\n\t\t\t\tvar lastPageFit = this._getLastPageFit();                       // последняя страница top которой меньше максимального scrollTop\n\t\t\t\tif (lastPageFit === this.options.pageCount) return scrollTop;   // если это самая последняя страница, то модифицировать scrollTop нет необходимости\n\t\t\t\tvar lastPageFitTop = this._getPagePosition(lastPageFit).top;\n\t\t\t\tvar docHeight = document.documentElement.scrollHeight;\n\t\t\t\tvar winHeight = document.documentElement.clientHeight;\n\t\t\t\tvar remainder = docHeight - (lastPageFitTop + winHeight); // сколько ещё будет возможно прокрутить после верхней границы lastPageFit\n\n\t\t\t\t// Когда остаток слишком мал, последние страницы слишком быстро переключаются, поэтому\n\t\t\t\tif (remainder < 300) {                      // если остаток меньше 300, то\n\t\t\t\t\tlastPageFitTop -= 300 - remainder;      // двигаем верхнюю границу последней вмещающейся страницы на разницу между 300 и текущим остатком\n\t\t\t\t\tremainder = 300;                        // устанавливаем значение остатка в 300;\n\t\t\t\t}\n\n\t\t\t\t// увеличиваем scrollTop относительно того, сколько из пощитанного нами остатка уже прокрутили\n\t\t\t\tvar modificator = winHeight * ((scrollTop - lastPageFitTop) / remainder);\n\n\t\t\t\tif (scrollTop > lastPageFitTop) {\n\t\t\t\t\tscrollTop += modificator;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn scrollTop;\n\t\t},\n\n\t\t_calculatePageHeight: function(page) {\n\t\t\tvar pagePosition = this._getPagePosition(page);\n\n\t\t\treturn pagePosition.bottom - pagePosition.top;\n\t\t},\n\n\t\t_getPagePosition: function(page) {\n\t\t\tif (this.pagesPositions[page]) return this.pagesPositions[page];\n\t\t\tvar $itemLast = this._getLastItemOnPage(page);\n\n\t\t\tthis.pagesPositions[page] = {\n\t\t\t\ttop: this._getFirstItemOnPage(page).offset().top,\n\t\t\t\tbottom: $itemLast.offset().top + $itemLast.outerHeight()\n\t\t\t};\n\n\t\t\treturn this.pagesPositions[page];\n\t\t},\n\n\t\t_getLastPageFit: function() {\n\t\t\tfor (var i = this.pagesPositions.length - 1; i > 0; i--) {\n\t\t\t\tif (document.documentElement.scrollHeight - this._getPagePosition(i).top > document.documentElement.clientHeight) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn i;\n\t\t},\n\n\t\t_getVisiblePage: function(scrollTop) {\n\t\t\tfor (var i = this.pagesPositions.length - 1; i > 0; i--) {\n\t\t\t\tvar pagePosition = this._getPagePosition(i);\n\t\t\t\tif (scrollTop >= pagePosition.top && scrollTop <= pagePosition.bottom) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this.currentPage;\n\t\t},\n\n\t\t_getFirstItemOnPage: function(page) {\n\t\t\treturn this.$element.find(this.options.selectors.itemFirst + '[data-page=\"' + page + '\"]');\n\t\t},\n\n\t\t_getLastItemOnPage: function(page) {\n\t\t\treturn this.$element.find(this.options.selectors.itemLast + '[data-page=\"' + page + '\"]');\n\t\t},\n\n\t\t_pageItemsEnhancment: function($element, page) {\n\t\t\t$element.find(this.options.selectors.items + ':first')\n\t\t\t\t.addClass(this.options.selectors.itemFirst.slice(1))\n\t\t\t\t.attr('data-page', page);\n\t\t\t$element.find(this.options.selectors.items + ':last')\n\t\t\t\t.addClass(this.options.selectors.itemLast.slice(1))\n\t\t\t\t.attr('data-page', page);\n\t\t},\n\n\t\t_delayFunctionCall: function(times, interval, func) {\n\t\t\tvar callCount = 0;\n\t\t\tvar startTime = (new Date()).getTime();\n\t\t\tvar timeout;\n\t\t\tvar self = this;\n\t\t\tif (typeof func !== 'function') return false;\n\t\t\ttimes = times || 1;\n\t\t\tinterval = interval || 50;\n\n\t\t\treturn function() {\n\t\t\t\tvar callTime = (new Date()).getTime();\n\t\t\t\tvar args = arguments;\n\n\t\t\t\tif (callTime - startTime > interval) {\n\t\t\t\t\tcallCount = 0;\n\t\t\t\t\tstartTime = callTime;\n\t\t\t\t}\n\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\tfunc.apply(self, args);\n\t\t\t\t\tstartTime = (new Date()).getTime();\n\t\t\t\t}, interval - (callTime - startTime));\n\n\t\t\t\tif (callCount < times) {\n\t\t\t\t\tcallCount++;\n\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\treturn func.apply(self, args);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\tgeneratePagination: function(currentPage, countPages, pages, firstPages, lastPages) {\n\t\t\tpages = pages || 1;\n\t\t\tfirstPages = firstPages || 0;\n\t\t\tlastPages = lastPages || 0;\n\t\t\tvar ranges = [];\n\t\t\tvar result = [];\n\t\t\tvar firstHidedPages = firstPages ? 2 : 0;\n\t\t\tvar lastHidedPages = lastPages ? 2 : 0;\n\t\t\tvar minimumPages = pages + firstPages + lastPages + firstHidedPages / 2 + lastHidedPages / 2;\n\t\t\tvar beforeCurrentPage = Math.ceil((pages - 1) / 2);\n\t\t\tvar afterCurrentPage = pages - 1 - beforeCurrentPage;\n\t\t\tvar isFirstEnhancment = false;\n\t\t\tvar isLastEnhancment = false;\n\t\t\tvar number, i;\n\n\t\t\tif (countPages <= minimumPages) {\n\t\t\t\tranges.push({\n\t\t\t\t\tfrom: 1,\n\t\t\t\t\tto: countPages\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tisFirstEnhancment = currentPage <= firstPages + firstHidedPages + beforeCurrentPage;\n\t\t\t\tisLastEnhancment = currentPage + afterCurrentPage + lastPages + lastHidedPages > countPages;\n\n\t\t\t\tif (isFirstEnhancment) {\n\t\t\t\t\tranges.push({\n\t\t\t\t\t\tfrom: 1,\n\t\t\t\t\t\tto: Math.max(firstPages, 1) + firstHidedPages + beforeCurrentPage + afterCurrentPage\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tranges.push({\n\t\t\t\t\t\tfrom: 1,\n\t\t\t\t\t\tto: firstPages\n\t\t\t\t\t});\n\t\t\t\t\tif (firstHidedPages) {\n\t\t\t\t\t\tranges.push('...');\n\t\t\t\t\t}\n\t\t\t\t\tif (!isLastEnhancment) {\n\t\t\t\t\t\tranges.push({\n\t\t\t\t\t\t\tfrom: currentPage - beforeCurrentPage,\n\t\t\t\t\t\t\tto: currentPage\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (isLastEnhancment) {\n\t\t\t\t\tranges.push({\n\t\t\t\t\t\tfrom: countPages + 1 - afterCurrentPage - beforeCurrentPage - Math.max(lastPages, 1) - lastHidedPages,\n\t\t\t\t\t\tto: countPages\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tif (!isFirstEnhancment) {\n\t\t\t\t\t\tranges.push({\n\t\t\t\t\t\t\tfrom: currentPage + 1,\n\t\t\t\t\t\t\tto: currentPage + afterCurrentPage\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (lastHidedPages) {\n\t\t\t\t\t\tranges.push('...');\n\t\t\t\t\t}\n\t\t\t\t\tranges.push({\n\t\t\t\t\t\tfrom: countPages - lastPages + 1,\n\t\t\t\t\t\tto: countPages\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (i = 0; i < ranges.length; i++) {\n\t\t\t\tif (ranges[i].from) { // кря\n\t\t\t\t\tfor (var j = ranges[i].from; j <= ranges[i].to; j++) {\n\t\t\t\t\t\tnumber = new Number(j);\n\t\t\t\t\t\tif (j === currentPage) {\n\t\t\t\t\t\t\tnumber.isActive = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresult.push(number);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(ranges[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t};\n\n\t$.fn[pluginName] = function ( options ) {\n\t\tvar $element = this.first();\n\t\t$element.selector = this.selector + ':first';\n\t\tif (!$element.data(pluginName)) {\n\t\t\t$element.data(pluginName,\n\t\t\t\tnew Ufi($element, options));\n\t\t}\n\t\treturn this;\n\t};\n\n})(jQuery, window, document);"],"sourceRoot":"/source/"}